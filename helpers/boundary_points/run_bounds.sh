#!/usr/bin/env bash
#SBATCH --account=def-cbright
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=4G
set -euo pipefail

# This will run all points up to n=180 on a single job
# CNF needs 8-12GB past n=180;
# The sortnetwrk and cardnetwrk both use more RAM

usage() {
cat << EOF
Usage: $0 e.g. ./run_bounds.sh -k 7 -s 1 -c 0 -v 1 -a 0 -l 0 -b 2 -f 0 -t 0 -r 0 -e seqcounter

Options:
  -k   k value
  -s   (0,1) symmetry break (0=off, 1=on)
  -v   Vertical/horizontal binary clauses (0=off, 1=on)
  -a   antidiagonal constraints (0=off, 1=on)
  -l   line length for antidiagonal and v/h binary constraints (0= one point, 5= six points)
  -c   Vertical/horizontal Cardinality constraints (0=off, 1=on)
  -b   boundary constraints (0=off, 1=unit, 2=unit+binary)
  -f   1=KNF (cardinality cadical), 0=CNF (cadical)
  -t   wall-clock timeout for SAT solver (s)
  -r   SAT solver seed
  -e   (Optional) CNF cardinality encoding type: seqcounter, totalizer, sortnetwrk, cardnetwrk, mtotalizer, kmtotalizer
  -i   bounds to run: 1=points_all_180, 2=points_all_past_180, 3=points_SAT_180, 4=points_UNSAT_180, 5=points_SAT_past_180, 6=points_UNSAT_past_180
  -h   help
EOF
}

options=$(getopt "hk:l:s:v:a:c:b:f:t:r:e:i:" "$@")
eval set -- "$options"

k= l= s= v= a= c= b= f= t= r= e= i=

while true; do
  case "$1" in
    -h) usage; exit 0 ;;
    -k) k="$2"; shift 2 ;;
    -l) l="$2"; shift 2 ;;
    -s) s="$2"; shift 2 ;;
    -v) v="$2"; shift 2 ;;
    -a) a="$2"; shift 2 ;;
    -c) c="$2"; shift 2 ;;
    -b) b="$2"; shift 2 ;;
    -f) f="$2"; shift 2 ;;
    -t) t="$2"; shift 2 ;;
    -r) r="$2"; shift 2 ;;
    -e) e="$2"; shift 2 ;;
    -i) e="$2"; shift 2 ;;    
    --) shift; break ;;
    *)  echo "Bad option"; usage; exit 2 ;;
  esac
done

# required for pysat and encoding types
if [[ -n "${e:-}" ]]; then
  if [[ $(hostname) == *".fir.alliancecan.ca" || -n "${CC_CLUSTER:-}" ]]; then
    module load python/3.11
    virtualenv --no-download "$SLURM_TMPDIR/env"
    source "$SLURM_TMPDIR/env/bin/activate"
    pip install "python-sat[pblib,aiger]"
  fi
fi

points_SAT_180=(
  #UB sat up to 180
  "(0,0)" "(0,1)" "(0,2)" "(0,3)" "(0,4)" "(0,5)" "(1,5)" "(1,6)" "(1,7)" "(1,8)" "(1,9)" "(1,10)" "(2,10)" "(2,11)" "(2,12)" "(2,13)" "(2,14)" "(2,15)" "(3,15)" "(3,16)" "(3,17)" "(3,18)" "(3,19)" "(3,20)" "(4,20)" "(4,21)" "(4,22)" "(4,23)" "(4,24)" "(4,25)" "(5,25)" "(5,26)" "(5,27)" "(5,28)" "(5,29)" "(5,30)" "(7,29)" "(7,30)" "(7,31)" "(7,32)" "(8,32)" "(8,33)" "(8,34)" "(8,35)" "(8,36)" "(9,36)" "(9,37)" "(9,38)" "(9,39)" "(9,40)" "(10,40)" "(10,41)" "(10,42)" "(10,43)" "(11,43)" "(11,44)" "(12,44)" "(12,45)" "(12,46)" "(13,46)" "(13,47)" "(13,48)" "(14,48)" "(14,49)" "(14,50)" "(14,51)" "(15,51)" "(15,52)" "(15,53)" "(15,54)" "(16,54)" "(16,55)" "(16,56)" "(16,57)" "(17,57)" "(17,58)" "(17,59)" "(18,59)" "(18,60)" "(18,61)" "(18,62)" "(19,62)" "(19,63)" "(19,64)" "(20,64)" "(20,65)" "(20,66)" "(21,66)" "(21,67)" "(21,68)" "(22,68)" "(22,69)" "(23,69)" "(23,70)" "(24,70)" "(24,71)" "(24,72)" "(25,72)" "(25,73)" "(25,74)" "(26,74)" "(26,75)" "(26,76)" "(26,77)" "(27,77)" "(27,78)" "(27,79)" "(28,79)" "(28,80)" "(28,81)" "(29,81)" "(29,82)" "(30,82)" "(30,83)" "(30,84)" "(30,85)" "(31,85)" "(32,85)" "(32,86)" "(32,87)" "(33,87)" "(34,87)" "(34,88)" "(35,88)" "(35,89)" "(35,90)" "(36,90)" "(36,91)" "(39,89)" "(39,90)" "(40,90)" "(40,91)" "(40,92)" "(41,92)" "(41,93)" "(41,94)" "(42,94)" "(42,95)" "(42,96)" "(43,96)" "(43,97)" "(43,98)" "(44,98)" "(44,99)" "(44,100)" "(45,100)" "(45,101)" "(46,101)" "(46,102)" "(46,103)" "(47,103)" "(47,104)" "(47,105)" "(48,105)" "(48,106)" "(48,107)" "(49,107)" "(49,108)" "(50,108)" "(50,109)" "(50,110)" "(51,110)" "(51,111)" "(51,112)" "(52,112)" "(52,113)" "(52,114)" "(53,114)" "(53,115)" "(53,116)" "(54,116)" "(54,117)" "(54,118)" "(55,118)" "(55,119)" "(55,120)" "(56,120)" "(56,121)" "(56,122)" "(57,122)"
  #LB sat up to 180
  "(0,0)" "(0,1)" "(1,1)" "(2,1)" "(3,1)" "(4,1)" "(5,1)" "(5,2)" "(6,2)" "(7,2)" "(8,2)" "(9,2)" "(10,2)" "(10,3)" "(11,3)" "(12,3)" "(13,3)" "(14,3)" "(15,3)" "(15,4)" "(16,4)" "(17,4)" "(18,4)" "(19,4)" "(20,4)" "(20,5)" "(21,5)" "(22,5)" "(23,5)" "(24,5)" "(25,5)" "(25,6)" "(26,6)" "(27,6)" "(28,6)" "(29,6)" "(29,7)" "(29,8)" "(30,8)" "(31,8)" "(32,8)" "(32,9)" "(33,9)" "(34,9)" "(35,9)" "(36,9)" "(36,10)" "(37,10)" "(38,10)" "(39,10)" "(40,10)" "(40,11)" "(41,11)" "(42,11)" "(42,12)" "(43,12)" "(44,12)" "(44,13)" "(44,14)" "(45,14)" "(46,14)" "(47,14)" "(47,15)" "(48,15)" "(49,15)" "(50,15)" "(50,16)" "(51,16)" "(52,16)" "(53,16)" "(53,17)" "(54,17)" "(55,17)" "(56,17)" "(56,18)" "(57,18)" "(58,18)" "(58,19)" "(59,19)" "(60,19)" "(61,19)" "(61,20)" "(62,20)" "(63,20)" "(63,21)" "(64,21)" "(65,21)" "(65,22)" "(66,22)" "(66,23)" "(67,23)" "(68,23)" "(68,24)" "(69,24)" "(70,24)" "(70,25)" "(71,25)" "(72,25)" "(72,26)" "(73,26)" "(74,26)" "(74,27)" "(75,27)" "(76,27)" "(77,27)" "(77,28)" "(78,28)" "(78,29)" "(79,29)" "(80,29)" "(81,29)" "(81,30)" "(82,30)" "(82,31)" "(83,31)" "(84,31)" "(85,31)" "(85,32)" "(85,33)" "(86,33)" "(87,33)" "(87,34)" "(87,35)" "(88,35)" "(88,36)" "(88,39)" "(88,40)" "(89,36)" "(89,37)" "(89,40)" "(89,41)" "(90,41)" "(91,41)" "(91,42)" "(92,42)" "(93,42)" "(93,43)" "(94,43)" "(95,43)" "(95,44)" "(96,44)" "(97,44)" "(97,45)" "(98,45)" "(99,45)" "(99,46)" "(100,46)" "(101,46)" "(101,47)" "(102,47)" "(103,47)" "(103,48)" "(104,48)" "(104,49)" "(105,49)" "(106,49)" "(106,50)" "(107,50)" "(108,50)" "(108,51)" "(109,51)" "(110,51)" "(110,52)" "(111,52)" "(111,53)" "(112,53)" "(113,53)" "(114,53)" "(114,54)" "(115,54)" "(115,55)" "(116,55)" "(117,55)" "(117,56)" "(118,56)" "(119,56)" "(119,57)" "(120,57)" "(121,57)" "(121,58)"
)

points_UNSAT_180=(
  #UB unsat up to 180
  "(0,6)" "(1,11)" "(2,16)" "(3,21)" "(4,26)" "(5,31)" "(6,30)" "(7,33)" "(8,37)" "(9,41)" "(10,44)" "(11,45)" "(12,47)" "(13,49)" "(14,52)" "(15,55)" "(16,58)" "(17,60)" "(18,63)" "(19,65)" "(20,67)" "(21,69)" "(22,70)" "(23,71)" "(24,73)" "(25,75)" "(26,78)" "(27,80)" "(28,82)" "(29,83)" "(30,86)" "(31,86)" "(32,88)" "(33,88)" "(34,89)" "(35,91)" "(36,92)" "(37,91)" "(38,90)" "(39,91)" "(40,93)" "(41,95)" "(42,97)" "(43,99)" "(44,101)" "(45,102)" "(46,104)" "(47,106)" "(48,108)" "(49,109)" "(50,111)" "(51,113)" "(52,115)" "(53,117)" "(54,119)" "(55,121)" "(56,123)"
  #LB unsat up to 180
  "(1,0)" "(6,1)" "(11,2)" "(16,3)" "(21,4)" "(26,5)" "(30,6)" "(30,7)" "(33,8)" "(37,9)" "(41,10)" "(43,11)" "(45,12)" "(45,13)" "(48,14)" "(51,15)" "(54,16)" "(57,17)" "(59,18)" "(62,19)" "(64,20)" "(66,21)" "(67,22)" "(69,23)" "(71,24)" "(73,25)" "(75,26)" "(78,27)" "(79,28)" "(82,29)" "(83,30)" "(86,31)" "(86,32)" "(88,33)" "(88,34)" "(89,35)" "(89,38)" "(89,39)" "(90,36)" "(90,37)" "(90,40)" "(92,41)" "(94,42)" "(96,43)" "(98,44)" "(100,45)" "(102,46)" "(104,47)" "(105,48)" "(107,49)" "(109,50)" "(111,51)" "(112,52)" "(115,53)" "(116,54)" "(118,55)" "(120,56)" "(122,57)" 
)

points_SAT_past_180=(
  #UB sat past
  "(57,123)" "(57,124)" "(58,124)" "(58,125)" "(59,125)" "(59,126)" "(59,127)" "(60,127)" "(60,128)" "(60,129)" "(61,129)" "(61,130)" "(62,130)" "(62,131)" "(62,132)" "(63,132)" "(63,133)" "(63,134)" "(64,134)" "(64,135)" "(65,135)" "(65,136)" "(65,137)" "(66,137)" "(66,138)" "(66,139)" "(67,139)" "(67,140)" "(68,140)" "(68,141)" "(68,142)" "(69,142)" "(69,143)" "(70,143)" "(70,144)" "(70,145)" "(71,145)" "(71,146)" "(71,147)" "(72,147)" "(72,148)" "(73,148)" "(73,149)" "(73,150)" "(74,150)" "(74,151)" "(74,152)" "(75,152)" "(75,153)" "(75,154)" "(76,154)" "(76,155)" "(77,155)" "(78,155)" "(78,156)" "(80,155)" "(80,156)" "(80,157)" "(81,157)" "(81,158)" "(82,158)" "(82,159)" "(82,160)" "(82,161)" "(83,161)" "(83,162)" "(84,162)" "(84,163)" "(84,164)" "(85,164)" "(85,165)" "(86,165)" "(86,166)" "(87,166)" "(87,167)" "(88,167)" "(88,168)" "(88,169)" "(89,169)" "(89,170)" "(90,170)" "(90,171)"
  #LB sat past 180
  "(122,58)" "(123,58)" "(123,59)" "(124,59)" "(125,59)" "(125,60)" "(126,60)" "(126,61)" "(127,61)" "(128,61)" "(128,62)" "(129,62)" "(130,62)" "(130,63)" "(131,63)" "(131,64)" "(132,64)" "(133,64)" "(133,65)" "(134,65)" "(135,65)" "(135,66)" "(136,66)" "(136,67)" "(137,67)" "(138,67)" "(138,68)" "(139,68)" "(140,68)" "(140,69)" "(141,69)" "(141,70)" "(142,70)" "(143,70)" "(143,71)" "(144,71)" "(144,72)" "(145,72)" "(146,72)" "(146,73)" "(147,73)" "(148,73)" "(148,74)" "(149,74)" "(150,74)" "(150,75)" "(151,75)" "(152,75)" "(152,76)" "(153,76)" "(153,77)" "(153,78)" "(154,78)" "(154,79)" "(155,79)" "(155,80)" "(155,81)" "(156,81)" "(157,81)" "(157,82)" "(158,82)" "(158,83)" "(159,83)" "(159,84)" "(160,84)" "(161,84)" "(161,85)" "(162,85)" "(163,85)" "(164,85)" "(164,86)" "(164,87)" "(165,87)" "(165,88)" "(166,88)" "(167,88)" "(167,89)" "(168,89)" "(168,90)" "(169,90)" "(170,90)" "(170,91)" "(171,91)" "(171,92)" "(172,92)" "(173,92)" "(173,93)" "(174,93)"] 
)

points_UNSAT_past_180=(
  #UB unsat past 180
  "(57,125)" "(58,126)" "(59,128)" "(60,130)" "(61,131)" "(62,133)" "(63,135)" "(64,136)" "(65,138)" "(66,140)" "(67,141)" "(68,143)" "(69,144)" "(70,146)" "(71,148)" "(72,149)" "(73,151)" "(74,153)" "(75,155)" "(76,156)" "(77,156)" "(78,157)" "(79,156)" "(80,158)" "(81,159)" "(82,162)" "(83,163)" "(84,165)" "(85,166)" "(86,167)" "(87,168)" "(88,170)" "(89,171)"
  #LB unsat past 180
  "(124,58)" "(126,59)" "(127,60)" "(129,61)" "(131,62)" "(132,63)" "(134,64)" "(136,65)" "(137,66)" "(139,67)" "(141,68)" "(142,69)" "(144,70)" "(145,71)" "(147,72)" "(149,73)" "(151,74)" "(153,75)" "(154,76)" "(154,77)" "(155,78)" "(156,79)" "(156,80)" "(158,81)" "(159,82)" "(160,83)" "(162,84)" "(165,85)" "(165,86)" "(166,87)" "(168,88)" "(169,89)" "(171,90)" "(172,91)" "(174,92)"
)
points_all_180=(
    "(0,0)" "(0,1)" "(0,2)" "(0,3)" "(0,4)" "(0,5)" "(0,6)" "(1,0)"  "(1,1)" "(1,5)" "(1,6)" "(1,7)" "(1,8)" "(1,9)" "(1,10)" "(1,11)"  "(2,1)" "(2,10)" "(2,11)" "(2,12)" "(2,13)" "(2,14)" "(2,15)" "(2,16)"  "(3,1)" "(3,15)" "(3,16)" "(3,17)" "(3,18)" "(3,19)" "(3,20)" "(3,21)"  "(4,1)" "(4,20)" "(4,21)" "(4,22)" "(4,23)" "(4,24)" "(4,25)" "(4,26)"  "(5,1)" "(5,2)" "(5,25)" "(5,26)" "(5,27)" "(5,28)" "(5,29)" "(5,30)" "(5,31)" "(6,1)" "(6,2)" "(6,30)" "(7,2)" "(7,29)" "(7,30)" "(7,31)"  "(7,32)" "(7,33)" "(8,2)" "(8,32)" "(8,33)" "(8,34)" "(8,35)" "(8,36)"  "(8,37)" "(9,2)" "(9,36)" "(9,37)" "(9,38)" "(9,39)" "(9,40)" "(9,41)"  "(10,2)" "(10,3)" "(10,40)" "(10,41)" "(10,42)" "(10,43)" "(10,44)" "(11,2)"  "(11,3)" "(11,43)" "(11,44)" "(11,45)" "(12,3)" "(12,44)" "(12,45)" "(12,46)"  "(12,47)" "(13,3)" "(13,46)" "(13,47)" "(13,48)" "(13,49)" "(14,3)" "(14,48)"  "(14,49)" "(14,50)" "(14,51)" "(14,52)" "(15,3)" "(15,4)" "(15,51)" "(15,52)"  "(15,53)" "(15,54)" "(15,55)" "(16,3)" "(16,4)" "(16,54)" "(16,55)" "(16,56)"  "(16,57)" "(16,58)" "(17,4)" "(17,57)" "(17,58)" "(17,59)" "(17,60)" "(18,4)"  "(18,59)" "(18,60)" "(18,61)" "(18,62)" "(18,63)" "(19,4)" "(19,62)" "(19,63)"  "(19,64)" "(19,65)" "(20,4)" "(20,5)" "(20,64)" "(20,65)" "(20,66)" "(20,67)"  "(21,4)" "(21,5)" "(21,66)" "(21,67)" "(21,68)" "(21,69)" "(22,5)" "(22,68)"  "(22,69)" "(22,70)" "(23,5)" "(23,69)" "(23,70)" "(23,71)" "(24,5)" "(24,70)"  "(24,71)" "(24,72)" "(24,73)" "(25,5)" "(25,6)" "(25,72)" "(25,73)" "(25,74)"  "(25,75)" "(26,5)" "(26,6)" "(26,74)" "(26,75)" "(26,76)" "(26,77)" "(26,78)"  "(27,6)" "(27,77)" "(27,78)" "(27,79)" "(27,80)" "(28,6)" "(28,79)" "(28,80)"  "(28,81)" "(28,82)" "(29,6)" "(29,7)" "(29,8)" "(29,81)" "(29,82)" "(29,83)"  "(30,6)" "(30,7)" "(30,8)" "(30,82)" "(30,83)" "(30,84)" "(30,85)" "(30,86)" "(31,8)" "(31,85)" "(31,86)" "(32,8)" "(32,9)" "(32,85)" "(32,86)" "(32,87)"  "(32,88)" "(33,8)" "(33,9)" "(33,87)" "(33,88)" "(34,9)" "(34,87)" "(34,88)"  "(34,89)" "(35,9)" "(35,88)" "(35,89)" "(35,90)" "(35,91)" "(36,9)" "(36,10)"  "(36,90)" "(36,91)" "(36,92)" "(37,9)" "(37,10)" "(37,91)" "(38,10)" "(38,90)"  "(39,10)" "(39,89)" "(39,90)" "(39,91)" "(40,10)" "(40,11)" "(40,90)" "(40,91)"  "(40,92)" "(40,93)" "(41,10)" "(41,11)" "(41,92)" "(41,93)" "(41,94)" "(41,95)"  "(42,11)" "(42,12)" "(42,94)" "(42,95)" "(42,96)" "(42,97)" "(43,11)" "(43,12)"  "(43,96)" "(43,97)" "(43,98)" "(43,99)" "(44,12)" "(44,13)" "(44,14)" "(44,98)"  "(44,99)" "(44,100)" "(44,101)" "(45,12)" "(45,13)" "(45,14)" "(45,100)" "(45,101)"  "(45,102)" "(46,14)" "(46,101)" "(46,102)" "(46,103)" "(46,104)" "(47,14)" "(47,15)"  "(47,103)" "(47,104)" "(47,105)" "(47,106)" "(48,14)" "(48,15)" "(48,105)" "(48,106)"  "(48,107)" "(48,108)" "(49,15)" "(49,107)" "(49,108)" "(49,109)" "(50,15)" "(50,16)"  "(50,108)" "(50,109)" "(50,110)" "(50,111)" "(51,15)" "(51,16)" "(51,110)" "(51,111)"  "(51,112)" "(51,113)" "(52,16)" "(52,112)" "(52,113)" "(52,114)" "(52,115)" "(53,16)"  "(53,17)" "(53,114)" "(53,115)" "(53,116)" "(53,117)" "(54,16)" "(54,17)" "(54,116)"  "(54,117)" "(54,118)" "(54,119)" "(55,17)" "(55,118)" "(55,119)" "(55,120)" "(55,121)"  "(56,17)" "(56,18)" "(56,120)" "(56,121)" "(56,122)" "(56,123)" "(57,17)" "(57,18)"  "(57,122)" "(58,18)" "(58,19)" "(59,18)" "(59,19)" "(60,19)" "(61,19)" "(61,20)"  "(62,19)" "(62,20)" "(63,20)" "(63,21)" "(64,20)" "(64,21)" "(65,21)" "(65,22)"  "(66,21)" "(66,22)" "(66,23)" "(67,22)" "(67,23)" "(68,23)" "(68,24)" "(69,23)"  "(69,24)" "(70,24)" "(70,25)" "(71,24)" "(71,25)" "(72,25)" "(72,26)" "(73,25)"  "(73,26)" "(74,26)" "(74,27)" "(75,26)" "(75,27)" "(76,27)" "(77,27)" "(77,28)"  "(78,27)" "(78,28)" "(78,29)" "(79,28)" "(79,29)" "(80,29)" "(81,29)" "(81,30)"  "(82,29)" "(82,30)" "(82,31)" "(83,30)" "(83,31)" "(84,31)" "(85,31)" "(85,32)" "(85,33)" "(86,31)" "(86,32)" "(86,33)" "(87,33)" "(87,34)" "(87,35)" "(88,33)"  "(88,34)" "(88,35)" "(88,36)" "(88,39)" "(88,40)" "(89,35)" "(89,36)" "(89,37)"  "(89,38)" "(89,39)" "(89,40)" "(89,41)" "(90,36)" "(90,37)" "(90,40)" "(90,41)"  "(91,41)" "(91,42)" "(92,41)" "(92,42)" "(93,42)" "(93,43)" "(94,42)" "(94,43)"  "(95,43)" "(95,44)" "(96,43)" "(96,44)" "(97,44)" "(97,45)" "(98,44)" "(98,45)"  "(99,45)" "(99,46)" "(100,45)" "(100,46)" "(101,46)" "(101,47)" "(102,46)" "(102,47)"  "(103,47)" "(103,48)" "(104,47)" "(104,48)" "(104,49)" "(105,48)" "(105,49)" "(106,49)"  "(106,50)" "(107,49)" "(107,50)" "(108,50)" "(108,51)" "(109,50)" "(109,51)" "(110,51)"  "(110,52)" "(111,51)" "(111,52)" "(111,53)" "(112,52)" "(112,53)" "(113,53)" "(114,53)"  "(114,54)" "(115,53)" "(115,54)" "(115,55)" "(116,54)" "(116,55)" "(117,55)" "(117,56)"  "(118,55)" "(118,56)" "(119,56)" "(119,57)" "(120,56)" "(120,57)" "(121,57)" "(121,58)"  "(122,57)"
)

points_all_past_180=(
    "(57,123)" "(57,124)" "(57,125)" "(58,124)" "(58,125)" "(58,126)" "(59,125)" "(59,126)"  "(59,127)" "(59,128)" "(60,127)" "(60,128)" "(60,129)" "(60,130)" "(61,129)" "(61,130)"  "(61,131)" "(62,130)" "(62,131)" "(62,132)" "(62,133)" "(63,132)" "(63,133)" "(63,134)"  "(63,135)" "(64,134)" "(64,135)" "(64,136)" "(65,135)" "(65,136)" "(65,137)" "(65,138)"  "(66,137)" "(66,138)" "(66,139)" "(66,140)" "(67,139)" "(67,140)" "(67,141)" "(68,140)"  "(68,141)" "(68,142)" "(68,143)" "(69,142)" "(69,143)" "(69,144)" "(70,143)" "(70,144)"  "(70,145)" "(70,146)" "(71,145)" "(71,146)" "(71,147)" "(71,148)" "(72,147)" "(72,148)"  "(72,149)" "(73,148)" "(73,149)" "(73,150)" "(73,151)" "(74,150)" "(74,151)" "(74,152)"  "(74,153)" "(75,152)" "(75,153)" "(75,154)" "(75,155)" "(76,154)" "(76,155)" "(76,156)"  "(77,155)" "(77,156)" "(78,155)" "(78,156)" "(78,157)" "(79,156)" "(80,155)" "(80,156)"  "(80,157)" "(80,158)" "(81,157)" "(81,158)" "(81,159)" "(82,158)" "(82,159)" "(82,160)"  "(82,161)" "(82,162)" "(83,161)" "(83,162)" "(83,163)" "(84,162)" "(84,163)" "(84,164)"  "(84,165)" "(85,164)" "(85,165)" "(85,166)" "(86,165)" "(86,166)" "(86,167)" "(87,166)"  "(87,167)" "(87,168)" "(88,167)" "(88,168)" "(88,169)" "(88,170)" "(89,169)" "(89,170)"  "(89,171)" "(90,170)" "(90,171)" "(122,58)" "(123,58)" "(123,59)" "(124,58)" "(124,59)"  "(125,59)" "(125,60)" "(126,59)" "(126,60)" "(126,61)" "(127,60)" "(127,61)" "(128,61)"  "(128,62)" "(129,61)" "(129,62)" "(130,62)" "(130,63)" "(131,62)" "(131,63)" "(131,64)"  "(132,63)" "(132,64)" "(133,64)" "(133,65)" "(134,64)" "(134,65)" "(135,65)" "(135,66)"  "(136,65)" "(136,66)" "(136,67)" "(137,66)" "(137,67)" "(138,67)" "(138,68)" "(139,67)"  "(139,68)" "(140,68)" "(140,69)" "(141,68)" "(141,69)" "(141,70)" "(142,69)" "(142,70)"  "(143,70)" "(143,71)" "(144,70)" "(144,71)" "(144,72)" "(145,71)" "(145,72)" "(146,72)"  "(146,73)" "(147,72)" "(147,73)" "(148,73)" "(148,74)" "(149,73)" "(149,74)" "(150,74)"  "(150,75)" "(151,74)" "(151,75)" "(152,75)" "(152,76)" "(153,75)" "(153,76)" "(153,77)"  "(153,78)" "(154,76)" "(154,77)" "(154,78)" "(154,79)" "(155,78)" "(155,79)" "(155,80)" "(155,81)" "(156,79)" "(156,80)" "(156,81)" "(157,81)" "(157,82)" "(158,81)" "(158,82)"  "(158,83)" "(159,82)" "(159,83)" "(159,84)" "(160,83)" "(160,84)" "(161,84)" "(161,85)"  "(162,84)" "(162,85)" "(163,85)" "(164,85)" "(164,86)" "(164,87)" "(165,85)" "(165,86)"  "(165,87)" "(165,88)" "(166,87)" "(166,88)" "(167,88)" "(167,89)" "(168,88)" "(168,89)"  "(168,90)" "(169,89)" "(169,90)" "(170,90)" "(170,91)" "(171,90)" "(171,91)" "(171,92)"  "(172,91)" "(172,92)" "(173,92)" "(173,93)" "(174,92)" "(174,93)"
)

case "$i" in
  1) points_to_run=("${points_all_180[@]}");        folder_name="points_all_180" ;;
  2) points_to_run=("${points_all_past_180[@]}");   folder_name="points_all_past_180" ;;
  3) points_to_run=("${points_SAT_180[@]}");        folder_name="points_SAT_180" ;;
  4) points_to_run=("${points_UNSAT_180[@]}");      folder_name="points_UNSAT_180" ;;
  5) points_to_run=("${points_SAT_past_180[@]}");   folder_name="points_SAT_past_180" ;;
  6) points_to_run=("${points_UNSAT_past_180[@]}"); folder_name="points_UNSAT_past_180" ;;
  *) echo "invalid i: $i" >&2; exit 1 ;;
esac

for point in "${points_to_run[@]}"; do
  point=${point#\(}
  point=${point%\)}
  x=${point%,*}
  y=${point#*,}
  x=${x// /}
  y=${y// /}

  n=$((x + y + 1))

  run_id="$(date +%F_%H-%M-%S)"
  : "${x:=0}" "${y:=0}" "${s:=1}" "${c:=0}" "${v:=1}" "${a:=0}" "${l:=0}" "${b:=0}" "${f:=0}" "${t:=0}" "${r:=0}"

  res_name="${folder_name}/res_k${k}_n${n}_x${x}_y${y}_s${s}_c${c}_v${v}_a${a}_l${l}_b${b}_f${f}_r${r}_e${e:-none}_${run_id}"

  mkdir -p "output/$res_name"

  python3 -u encode.py -k "$k" -n "$n" -l "$l" -a "$a" -v "$v" -c "$c" -s "$s" -x "$x" -y "$y" -b "$b" -t "$t" -f "$f" -r "$r" -p "$res_name" ${e:+-e "$e"}
  python3 -u solve.py  -k "$k" -n "$n" -x "$x" -y "$y" -t "$t" -f "$f" -r "$r" -p "$res_name" ${e:+-e "$e"}

  rm -f "output/$res_name/dimacsFile.knf" "output/$res_name/dimacsFile.cnf"
done

echo "All points processed."
